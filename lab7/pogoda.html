<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Алёшкина Варвара Максимовна. Лабораторная 7</title>
        <link rel="stylesheet" href="../main.css">
        <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
        <link rel="icon" href="../favicon-16x16.png">
        <link rel="icon" href="../favicon-32x32.png">
        <style>
            #weather-data {
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #e0e0e0;
                border-radius: 5px;
                background: #f8f9fa;
                max-width: 500px;
            }
            .temp-positive {
                color: #e74c3c;
                font-weight: bold;
            }
            .temp-negative {
                color: #3498db;
                font-weight: bold;
            }
            button {
                padding: 10px 15px;
                background: #4cafa3;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
        </style>
        <script>
            async function getWeather() {
                const weatherData = document.getElementById('weather-data');
                weatherData.innerHTML = '<p>Загрузка данных о погоде...</p>';
                
                try {
                    // Добавляем параметр для получения данных на 7 дней
                    const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=55.0415&longitude=82.9346&hourly=temperature_2m&timezone=Asia%2FNovosibirsk&forecast_days=1');
                    const data = await response.json();
                    
                    console.log("Полученные данные:", data); // Для отладки
                    
                    const times = data.hourly.time;
                    const temperatures = data.hourly.temperature_2m;
                    
                    if (!times || !temperatures || times.length === 0) {
                        throw new Error('Нет данных о температуре');
                    }
                    
                    // Ищем данные для нужных часов (8, 12, 20)
                    const results = {};
                    for (let i = 0; i < times.length; i++) {
                        const date = new Date(times[i]);
                        const hours = date.getHours();
                        
                        if ([8, 12, 20].includes(hours)) {
                            results[hours] = temperatures[i];
                        }
                    }
                    
                    // Формируем HTML
                    const weatherHTML = `
                        <h2>Прогноз температуры в Новосибирске на сегодня:</h2>
                        <ul>
                            <li>8:00 утра: ${formatTemp(results[8])}</li>
                            <li>12:00 дня: ${formatTemp(results[12])}</li>
                            <li>20:00 вечера: ${formatTemp(results[20])}</li>
                        </ul>
                        <p><small>Последнее обновление: ${new Date().toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</small></p>
                        <button onclick="getWeather()">Обновить данные</button>
                    `;
                    
                    weatherData.innerHTML = weatherHTML;
                } catch (error) {
                    console.error('Ошибка:', error);
                    weatherData.innerHTML = `
                        <p>Не удалось загрузить данные о погоде.</p>
                        <p><small>${error.message}</small></p>
                        <button onclick="getWeather()">Попробовать снова</button>
                    `;
                }
            }
            
            function formatTemp(temp) {
                if (temp === undefined || temp === null) return '<span style="color: #777">данные недоступны</span>';
                const tempClass = temp >= 0 ? 'temp-positive' : 'temp-negative';
                return `<span class="${tempClass}">${temp} °C</span>`;
            }
            
            // Загружаем данные при загрузке страницы
            document.addEventListener('DOMContentLoaded', getWeather);
        </script>
    </head>

    <body>
        <header>
            НГТУ, ФБ, Лабораторная работа 7
            <hr>
        </header>

        <main>
            <h1>Погода в Новосибирске</h1>
            <div id="weather-data">
                <p>Загрузка данных...</p>
            </div>
        </main>
    
        <footer>
            <hr>
            &copy; Алёшкина Варя, ФБИ-34, 2 курс, 2025
        </footer>
    </body>
</html>